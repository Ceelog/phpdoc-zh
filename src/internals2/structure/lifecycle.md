Life cycle of an extension
--------------------------

A PHP extension goes through several phases during its lifetime. All of
these phases are opportunities for the developer to perform various
initialization, termination, or informational functions. The Zend API
allows for hooks into five separate phases of an extension's existence,
apart from calls by PHP functions.

### Loading, unloading, and requests

As the Zend engine runs, it processes one or more "requests" from its
client. In the traditional CGI implementation, this corresponds to one
execution of a process. However, many other implementations, most
notably the Apache module, can map many requests onto a single PHP
process. A PHP extension may thus see many requests in its lifetime.

### Overview

-   <span class="simpara"> In the Zend API, a module is loaded into
    memory only once when the associated PHP process starts up. Each
    module receives a call to the "module initialization" function
    specified in its **`zend_module`** structure as it is loaded.
    </span>
-   <span class="simpara"> Whenever the associated PHP process starts to
    handle a request from its client - i.e. whenever the PHP interpreter
    is told to start working - each module receives a call to the
    "request initialization" function specified in its **`zend_module`**
    structure. </span>
-   <span class="simpara"> Whenever the associated PHP process is done
    handling a request, each module receives a call to the "request
    termination" function specified in its **`zend_module`** structure.
    </span>
-   <span class="simpara"> A given module is unloaded from memory when
    its associated PHP process is shut down in an orderly manner. The
    module receives a call to the "module termination" function
    specified in its **`zend_module`** structure at this time. </span>

### What to do, and when to do it

There are many tasks that might be performed at any of these four
points. This table details where many common initialization and
termination tasks belong.

| Module initialization/termination                          | Request initialization/termination                            |
|------------------------------------------------------------|---------------------------------------------------------------|
| Allocate/deallocate and initialize module global variables | Allocate/deallocate and initialize request-specific variables |
| Register/unregister class entries                          |                                                               |
| Register/unregister INI entries                            |                                                               |
| Register constants                                         |                                                               |

### The <span class="function">phpinfo</span> callback

Aside from globals initialization and certain rarely-used callbacks,
there is one more part of a module's lifecycle to examine: A call to
<span class="function">phpinfo</span>. The output a user sees from this
call, whether text or HTML or anything else, is generated by each
individual extension that is loaded into the PHP interpreter at the time
the call is made.

To provide for format-neutral output, the header "ext/standard/info.h"
provides an array of functions to produce standardized display elements.
Specifically, several functions which create the familiar tables exist:

<span class="function">php\_info\_print\_table\_start</span>  
<span class="simpara"> Open a table in <span
class="function">phpinfo</span> output. Takes no parameters. </span>

<span class="function">php\_info\_print\_table\_header</span>  
<span class="simpara"> Print a table header in <span
class="function">phpinfo</span> output. Takes one parameter, the number
of columns, plus the same number of <span class="type">char \*</span>
parameters which are the texts for each column heading. </span>

<span class="function">php\_info\_print\_table\_row</span>  
<span class="simpara"> Print a table row in <span
class="function">phpinfo</span> output. Takes one parameter, the number
of columns, plus the same number of <span class="type">char \*</span>
parameters which are the texts for each column content. </span>

<span class="function">php\_info\_print\_table\_end</span>  
<span class="simpara"> Close a table formerly opened by <span
class="function">php\_info\_print\_table\_start</span>. Takes no
parameters. </span>

Using these four functions, it is possible to produce status information
for nearly any combination of features in an extension. Here is the
information callback from the counter extension:

**示例 \#1 counter's PHP\_MINFO function**

``` c
/* {{{ PHP_MINFO(counter) */
PHP_MINFO_FUNCTION(counter)
{
    char        buf[10];

    php_info_print_table_start();
    php_info_print_table_row(2, "counter support", "enabled");
    snprintf(buf, sizeof(buf), "%ld", COUNTER_G(basic_counter_value));
    php_info_print_table_row(2, "Basic counter value", buf);
    php_info_print_table_end();
}
/* }}} */
```
